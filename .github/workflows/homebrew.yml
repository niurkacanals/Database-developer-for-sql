name: Homebrew Bump Formula
on:
  push:
    tags: 'v*'
#  release:
#    types: [published]
jobs:
  homebrew:
    runs-on: macos-latest
    steps:
      - name: checkout
        uses: actions/checkout@v3
      - name: bump formula
        env:
          - HOMEBREW_GITHUB_API_TOKEN: ${{ secrets.HOMEBREW_TOKEN }}
        run: |
          brew update
          brew tap xo/xo
          brew bump-formula-pr \
            --no-audit \
            --no-browse \
            --message="Update usql formula to ${{ git.ref_name }}" \
            --version="${{ git.ref_name }}" \
            --url="https://github.com/xo/usql/archive/${{ git.ref_name }}.tar.gz" \
            xo/xo/usql
