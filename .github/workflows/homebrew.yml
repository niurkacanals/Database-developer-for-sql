name: Homebrew Bump Formula
on:
  push:
    tags: 'v*'
#  release:
#    types: [published]
jobs:
  homebrew:
    runs-on: macos-latest
    steps:
      - name: checkout
        uses: actions/checkout@v3
      - name: bump formula
        env:
          - HOMEBREW_GITHUB_API_TOKEN: ${{ secrets.HOMEBREW_TOKEN }}
          - GITHUB_REF_NAME: ${{ github.ref_name }}
        run: |
          brew update
          brew tap xo/xo
          brew bump-formula-pr \
            --no-audit \
            --no-browse \
            --message="Update usql formula to ${GITHUB_REF_NAME}" \
            --version="${GITHUB_REF_NAME}" \
            --url="https://github.com/xo/usql/archive/${GITHUB_REF_NAME}.tar.gz" \
            xo/xo/usql
