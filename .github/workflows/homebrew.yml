name: Bump Homebrew Formula
on:
  push:
    tags: 'v*'
jobs:
  homebrew:
    runs-on: macos-latest
    steps:
      - name: checkout
        uses: actions/checkout@v3
      - name: bump formula
        env:
          HOMEBREW_GITHUB_API_TOKEN: ${{ secrets.HOMEBREW_TOKEN }}
        run: |
          brew update
          brew tap xo/xo
          brew bump-formula-pr \
            --no-audit \
            --no-browse \
            --force \
            --message="Update usql formula to ${{ github.ref_name }}" \
            --version="${{ github.ref_name }}" \
            --url="https://github.com/xo/usql/archive/${{ github.ref_name }}.tar.gz" \
            xo/xo/usql
